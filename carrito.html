<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tu Carrito | Café Cortero</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root{
      --marron:#512615;
      --verde:#33673B;
      --blanco:#ffffff;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:"Poppins",sans-serif;
      background:var(--blanco);
      color:var(--marron);
      padding-top:6rem;
    }
    header{
      position:fixed;
      top:0;width:100%;
      background:rgba(255,255,255,0.92);
      backdrop-filter:blur(6px);
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:.6rem 1.2rem;
      box-shadow:0 2px 10px rgba(0,0,0,.04);
      z-index:40;
    }
    header img{height:60px;}
    header a{color:var(--marron);text-decoration:none;font-weight:500;}
    main{max-width:700px;margin:0 auto;padding:1rem;}
    h1{text-align:center;font-size:2rem;margin-bottom:2rem;}
    .cart-item{
      background:#fff;
      border-radius:20px;
      box-shadow:0 4px 20px rgba(0,0,0,0.05);
      padding:1.5rem;
      margin-bottom:1.5rem;
      display:flex;
      align-items:center;
      gap:1.5rem;
    }
    .cart-item img{
      width:90px;height:90px;object-fit:contain;
      border-radius:12px;background:#f8f8f8;
    }
    .cart-info h3{font-size:1.03rem;margin-bottom:.3rem;}
    .cart-info small{color:#8c7866;font-size:.78rem;}
    .cart-controls{display:flex;align-items:center;gap:.4rem;margin-top:.7rem;}
    .btn-round{
      width:28px;height:28px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      border:none;cursor:pointer;font-size:1rem;color:#fff;
    }
    .btn-minus{background:#cfdddd;}
    .btn-plus{background:var(--verde);}
    .btn-del{background:#d72638;}
    .total-line{display:flex;justify-content:flex-end;font-weight:600;margin-top:.8rem;font-size:1.1rem;}
    .actions{display:flex;gap:1rem;justify-content:center;margin-top:2.2rem;}
    .btn-main{
      background:var(--verde);
      color:#fff;
      border:none;
      border-radius:999px;
      padding:.7rem 1.5rem;
      font-weight:500;
      cursor:pointer;
    }
    .empty{text-align:center;color:#8b6e5f;margin-top:2rem;}
    /* whatsapp flotante */
    .whatsapp-float {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: #25D366;
      color: white;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      z-index: 99;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html">
      <img src="imagenes/logo mejorado transparente.png" alt="Café Cortero">
    </a>
    <span style="font-weight:600;">Tu Carrito</span>
  </header>

  <main>
    <h1>Tu Carrito</h1>
    <div id="cart-container"></div>
    <div class="total-line" id="cart-total">Total: L 0.00</div>
    <div class="actions">
      <button class="btn-main" onclick="location.href='index.html'">Seguir comprando</button>
      <button class="btn-main" onclick="alert('Aquí pones tu forma de pedido (WhatsApp, formulario, etc.)');">Proceder con pedido</button>
    </div>
  </main>

  <a href="https://wa.me/50494546047?text=Hola%2C%20quiero%20confirmar%20mi%20pedido%20de%20Café%20Cortero" class="whatsapp-float" target="_blank">
    <i class="fa-brands fa-whatsapp"></i>
  </a>

  <script>
    const container = document.getElementById('cart-container');
    const totalEl = document.getElementById('cart-total');

    let cart = {};
    const saved = localStorage.getItem('cart');
    if (saved) {
      try { cart = JSON.parse(saved); }
      catch(e) { cart = {}; }
    }

    function priceToNumber(p) {
      // p viene como "L 180" -> 180
      if (!p) return 0;
      return Number(p.replace(/[^\d.]/g, "")) || 0;
    }

    function renderCart() {
      container.innerHTML = '';
      const names = Object.keys(cart);
      if (names.length === 0) {
        container.innerHTML = '<p class="empty">Tu carrito está vacío.</p>';
        totalEl.textContent = 'Total: L 0.00';
        return;
      }

      let total = 0;

      names.forEach(name => {
        const item = cart[name];
        const unit = priceToNumber(item.price);
        const sub = unit * item.qty;
        total += sub;

        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <img src="${item.img || 'imagenes/4.png'}" alt="${name}">
          <div class="cart-info">
            <h3>${name}</h3>
            <small>L ${unit.toFixed(2)} / unidad</small>
            <div class="cart-controls">
              <button class="btn-round btn-minus">-</button>
              <span>${item.qty}</span>
              <button class="btn-round btn-plus"><i class="fa-solid fa-plus" style="font-size:.7rem;"></i></button>
              <button class="btn-round btn-del"><i class="fa-solid fa-xmark"></i></button>
            </div>
          </div>
        `;
        // listeners
        div.querySelector('.btn-minus').onclick = () => {
          if (cart[name].qty > 1) {
            cart[name].qty--;
          } else {
            delete cart[name];
          }
          localStorage.setItem('cart', JSON.stringify(cart));
          renderCart();
        };
        div.querySelector('.btn-plus').onclick = () => {
          cart[name].qty++;
          localStorage.setItem('cart', JSON.stringify(cart));
          renderCart();
        };
        div.querySelector('.btn-del').onclick = () => {
          delete cart[name];
          localStorage.setItem('cart', JSON.stringify(cart));
          renderCart();
        };

        container.appendChild(div);
      });

      totalEl.textContent = 'Total: L ' + total.toFixed(2);
    }

    renderCart();
  </script>
</body>
</html>
