<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tu carrito | CafÃ© Cortero</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --marron: #512615;
      --verde: #33673B;
      --blanco: #ffffff;
      --fondo: #f5eee6;
    }
    * {margin:0; padding:0; box-sizing:border-box;}
    body {
      font-family: "Poppins", sans-serif;
      background: var(--fondo);
      color: var(--marron);
    }

    /* HEADER */
    header {
      background: var(--blanco);
      padding: .8rem 1.2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 10px rgba(0,0,0,.03);
    }
    header img {
      height: 60px;
    }
    .cart-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--marron);
    }

    /* CONTENIDO */
    main {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 0 1rem 3rem;
    }
    .item {
      background: #fff;
      border-radius: 20px;
      padding: 1.1rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 10px 25px rgba(0,0,0,.02);
    }
    .item img {
      width: 72px;
      height: 72px;
      object-fit: contain;
      background: #eff5ff;
      border-radius: 14px;
    }
    .item-info {flex: 1;}
    .item-name {font-weight: 600; margin-bottom: .2rem;}
    .item-price {font-size: .9rem; margin-bottom: .5rem;}
    .qty-controls {
      display: flex;
      gap: .4rem;
      align-items: center;
    }
    .qty-btn {
      background: var(--verde);
      color: #fff;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
    }
    .del-btn {
      background: #d72638;
      color: #fff;
      border: none;
      width: 30px; height: 30px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    .total-box {
      text-align: right;
      font-size: 1.3rem;
      font-weight: 600;
      margin-top: 2rem;
    }
    .actions {
      margin-top: 2rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .btn {
      border: none;
      background: var(--verde);
      color: #fff;
      padding: .7rem 1.5rem;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 500;
    }
    .empty {
      background: #fff;
      padding: 1.5rem 1rem;
      border-radius: 18px;
      text-align: center;
    }

    /* MENSAJE DE CONFIRMACIÃ“N */
    .confirm-box {
      text-align: center;
      background: #e9ffe9;
      border: 2px solid #48c774;
      color: #27632a;
      padding: 1rem;
      border-radius: 15px;
      font-weight: 600;
      font-size: 1.1rem;
      margin-top: 1.5rem;
      display: none;
      animation: fadeIn .5s ease-in-out;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }

    /* BOTÃ“N WHATSAPP */
    .whatsapp-float {
      position: fixed;
      bottom: 22px;
      right: 22px;
      background: #25D366;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 30px;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html">
      <img src="imagenes/logo%20mejorado%20trasmparente.png" alt="CafÃ© Cortero">
    </a>
    <span class="cart-title">Tu Carrito</span>
  </header>

  <main>
    <div id="cart-container"></div>
    <div class="total-box" id="total-box">Total: L 0.00</div>

    <div class="actions">
      <button class="btn" onclick="window.location.href='index.html'">Seguir comprando</button>
      <button class="btn" style="background:#512615;" onclick="sendToWhatsApp()">Proceder con pedido</button>
    </div>

    <div id="confirm-box" class="confirm-box">
      âœ… Pedido enviado con Ã©xito. Â¡Gracias por comprar con CafÃ© Cortero!
    </div>
  </main>

  <!-- BotÃ³n flotante WhatsApp -->
  <a href="https://wa.me/50494546047?text=Hola%2C%20quiero%20hacer%20un%20pedido%20de%20CafÃ©%20Cortero" class="whatsapp-float">
    <i class="fa-brands fa-whatsapp"></i>
  </a>

  <script>
    const CART_KEY = 'cafecortero_cart';

    function getCart() {
      return JSON.parse(localStorage.getItem(CART_KEY)) || [];
    }
    function saveCart(cart) {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function renderCart() {
      const cart = getCart();
      const container = document.getElementById('cart-container');
      container.innerHTML = '';

      if (cart.length === 0) {
        container.innerHTML = '<div class="empty">No tienes productos en el carrito.</div>';
        document.getElementById('total-box').textContent = 'Total: L 0.00';
        return;
      }

      let total = 0;
      cart.forEach((item, index) => {
        const priceNumber = parseFloat(item.price.replace('L','').trim());
        const lineTotal = priceNumber * item.qty;
        total += lineTotal;

        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}">
          <div class="item-info">
            <div class="item-name">${item.name}</div>
            <div class="item-price">L ${priceNumber.toFixed(2)} / unidad</div>
            <div class="qty-controls">
              <button class="qty-btn" data-action="minus" data-index="${index}">-</button>
              <span>${item.qty}</span>
              <button class="qty-btn" data-action="plus" data-index="${index}">+</button>
              <button class="del-btn" data-action="del" data-index="${index}">&times;</button>
            </div>
          </div>
        `;
        container.appendChild(div);
      });

      document.getElementById('total-box').textContent = 'Total: L ' + total.toFixed(2);
    }

    document.getElementById('cart-container').addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const action = btn.dataset.action;
      const index = parseInt(btn.dataset.index, 10);
      const cart = getCart();

      if (action === 'plus') {
        cart[index].qty += 1;
      } else if (action === 'minus') {
        cart[index].qty -= 1;
        if (cart[index].qty <= 0) {
          cart.splice(index, 1);
        }
      } else if (action === 'del') {
        cart.splice(index, 1);
      }

      saveCart(cart);
      renderCart();
    });

    // Enviar pedido a WhatsApp, limpiar carrito y mostrar mensaje
    function sendToWhatsApp() {
      const cart = getCart();
      if (cart.length === 0) {
        alert('Tu carrito estÃ¡ vacÃ­o.');
        return;
      }

      const fecha = new Date();
      const opciones = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' };
      const fechaHora = fecha.toLocaleString('es-HN', opciones);

      let message = `ðŸ•’ Pedido realizado el ${fechaHora}\n\n`;
      message += 'Hola, quiero hacer un pedido de CafÃ© Cortero:\n\n';

      let total = 0;
      cart.forEach(item => {
        const priceNumber = parseFloat(item.price.replace('L','').trim());
        const subtotal = priceNumber * item.qty;
        message += `â€¢ ${item.name} x${item.qty} = L ${subtotal.toFixed(2)}\n`;
        total += subtotal;
      });

      message += `\nðŸ’° Total: L ${total.toFixed(2)}\n\n`;
      message += 'Gracias por su preferencia â˜•';

      const url = `https://wa.me/50494546047?text=${encodeURIComponent(message)}`;

      // Vaciar carrito y actualizar
      localStorage.removeItem(CART_KEY);
      renderCart();

      // Mostrar mensaje de confirmaciÃ³n
      const confirmBox = document.getElementById('confirm-box');
      confirmBox.style.display = 'block';

      // Ocultar mensaje despuÃ©s de 5 segundos
      setTimeout(() => {
        confirmBox.style.display = 'none';
      }, 5000);

      // Abrir WhatsApp
      window.open(url, '_blank');
    }

    renderCart();
  </script>
</body>
</html>
